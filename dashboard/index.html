<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Status</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-white text-black min-h-screen flex flex-col items-center py-8 px-4">

  <h1 class="text-3xl font-bold mb-6 text-center">ðŸ“¶ Ping ke ZelApi</h1>

  <div class="bg-gray-100 rounded-xl shadow-md p-6 w-full max-w-md mb-8">
    <div class="flex justify-between items-center mb-4">
      <h2 class="text-xl font-semibold">Status Jaringan</h2>
      <span id="apiLabel" class="text-sm font-bold px-2 py-1 rounded bg-green-500 text-white">Online</span>
    </div>
    <p><strong>Status:</strong> <span id="apiStatus">-</span></p>
    <p><strong>Speed:</strong> <span id="apiSpeed">-</span></p>
    <p><strong>Region:</strong> <span id="apiRegion">Google Global</span></p>
  </div>

  <div class="w-full max-w-2xl">
    <canvas id="statusChart"></canvas>
  </div>

  <script>
    const apiStatusElem = document.getElementById("apiStatus");
    const apiSpeedElem = document.getElementById("apiSpeed");
    const apiLabel = document.getElementById("apiLabel");

    let times = [];
    let speeds = [];

    const chart = new Chart(document.getElementById("statusChart"), {
      type: 'line',
      data: {
        labels: times,
        datasets: [{
          label: 'Response Time (ms)',
          data: speeds,
          borderColor: 'rgb(59, 130, 246)',
          backgroundColor: 'rgba(59, 130, 246, 0.2)',
          tension: 0.4,
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { labels: { color: '#000' } },
        },
        scales: {
          x: { ticks: { color: '#555' }, grid: { color: '#ddd' } },
          y: { ticks: { color: '#555' }, grid: { color: '#ddd' } }
        }
      }
    });

    async function pingGoogle() {
      const now = new Date().toLocaleTimeString();

      try {
        const start = performance.now();
        await fetch("https://www.google.com", {
          method: "HEAD",
          mode: "no-cors",
        });
        const end = performance.now();
        const ms = Math.round(end - start);

        if (times.length >= 20) {
          times.shift();
          speeds.shift();
        }

        times.push(now);
        speeds.push(ms);
        chart.update();

        apiStatusElem.textContent = "Online";
        apiSpeedElem.textContent = ms + " ms";
        apiLabel.className = 'text-sm font-bold px-2 py-1 rounded bg-green-500 text-white';
        apiLabel.textContent = 'Online';
      } catch (err) {
        times.push(now);
        speeds.push(0);
        chart.update();

        apiStatusElem.textContent = "Offline";
        apiSpeedElem.textContent = "-";
        apiLabel.className = 'text-sm font-bold px-2 py-1 rounded bg-red-500 text-white';
        apiLabel.textContent = 'Offline';
      }
    }

    // Mulai ping setiap 1 detik
    pingGoogle();
    setInterval(pingGoogle, 1000);
  </script>

</body>
</html>
